use log::debug;
use std::{time::Instant};
use winterfell::{
    math::{fields::f23201::BaseElement, log2, FieldElement},
    ProofOptions, Prover, StarkProof, Trace, VerifierError, HashFunction, FieldExtension,
};

use crate::utils::poseidon_23_spec::{
    CYCLE_LENGTH as HASH_CYCLE_LEN, NUM_ROUNDS as NUM_HASH_ROUNDS,
    STATE_WIDTH as HASH_STATE_WIDTH, RATE_WIDTH as HASH_RATE_WIDTH,
    DIGEST_SIZE as HASH_DIGEST_WIDTH
};

pub mod air;
use air::ThinDilAir;

mod prover;
use prover::ThinDilProver;

use self::air::PublicInputs;

mod aux_trace_table;

// CONSTANTS
// ================================================================================================

const M: u32 = 7340033; // 2^23 - 2^20 + 1
pub const N: usize = 256;
pub const K: usize = 4;
const TAU: usize = 39; //The actual number of swaps gets rounded up to 40 which is fine for security
const SBALLEND: usize = TAU/HASH_CYCLE_LEN + 2; //Spending 6 HASH_CYCLES on BALLSAMPLE
const BETA: u64 = 80;
const ZLIMIT: u64 = 131072 - BETA; // 2^17 - BETA
const WHIGHSHIFT: u64 = 8;
const WLOWLIMIT: u64 = 65535-1;
const GAMMA2: u64 = 65536;
// pub const MUSIZE: usize = 23;

const ZRANGE: usize = 18;
const QRANGE: usize = 16;
const RRANGE: usize = 8;
const WLOWRANGE: usize = 17;
const WHIGHRANGE: usize = 6;

pub const PADDED_TRACE_LENGTH: usize = 512;
pub const _TRACE_LENGTH:usize = (TAU) + 2*HASH_CYCLE_LEN + N*HASH_CYCLE_LEN/6;

//////////////////////////
const CIND: usize = 0;

const QIND: usize = CIND + N;
const RIND: usize = QIND + HASH_CYCLE_LEN;
const SIGNIND: usize = RIND + HASH_CYCLE_LEN;

const QRANGEIND: usize = SIGNIND + HASH_CYCLE_LEN;
const RRANGEIND: usize = QRANGEIND + 2*QRANGE;

const SWAPDECIND: usize = RRANGEIND + 2*RRANGE;

const CTILDEIND: usize = SWAPDECIND + N;

const HASHIND: usize = CTILDEIND + HASH_DIGEST_WIDTH;

// Below show up only in result space
const QASSERT: usize = HASHIND + 3*HASH_STATE_WIDTH + 3*HASH_STATE_WIDTH; //3*HASH_STATE_WIDTH for hashing and double for assertions
const RASSERT: usize = QASSERT + 2;
const SWAPASSERT: usize = RASSERT + 2;
const NEGASSERT: usize = SWAPASSERT + 1;
const SWAPDECASSERT: usize = NEGASSERT+ 1;
const QRASSERT: usize = SWAPDECASSERT + 2;
const WDECASSERT: usize = QRASSERT + HASH_CYCLE_LEN;
const WLOWASSERT: usize = WDECASSERT + 2*4;
const WHIGHASSERT: usize = WLOWASSERT + 4;
const CTILDEASSERT: usize = WHIGHASSERT + 2*4;

/////////////////////////
const WHIGHIND: usize = QIND; // HASH_RATE_WIDTH wlow per row for first 6 rows. Placing everything at once because we permute
const WIND: usize = WHIGHIND + HASH_RATE_WIDTH; // 4 w per row for first 6 rows
const WBIND: usize = WIND + 4; // 4 wbit per row for first 6 rows
const WLOWIND: usize = WBIND + 4; // 4 w per row for first 6 rows
const ZIND: usize = WLOWIND + 4;
const QWIND: usize = ZIND + 4;

const ZRANGEIND: usize = QWIND + 4;
const WLOWRANGEIND: usize = ZRANGEIND + 8*ZRANGE;
const WHIGHRANGEIND: usize = WLOWRANGEIND + 4*WLOWRANGE;
const WASSERT: usize = WHIGHRANGEIND + 8*WHIGHRANGE;
const ZASSERT: usize = WASSERT + 4*3; // 4 w's, each has 3 checks
/////////////////////////
pub const TRACE_WIDTH: usize = HASHIND + 3*HASH_STATE_WIDTH;
pub const AUX_WIDTH: usize = 1 + 4 + 4 + 4 + 1; // C + Z + W + QW + GAMMA(random evaluation point)

pub const COM_START: usize = (HASH_CYCLE_LEN)*(SBALLEND+1);
pub const COM_END: usize = (HASH_CYCLE_LEN)*(SBALLEND+2);

pub const PIT_START: usize = (HASH_CYCLE_LEN)*(SBALLEND+3);
pub const PIT_END: usize = (HASH_CYCLE_LEN)*(4*N/24+HASH_CYCLE_LEN + 2);
pub const PIT_LEN: usize = (N+2)*HASH_CYCLE_LEN/(HASH_CYCLE_LEN-2); //todo:remove this constant -- maybe confusing
// Public key of Dilithium

const PUBT: [[u64;N];4] = [
    [4569968, 7246137, 2325141, 3876619, 1427607, 95059, 6282592, 545369, 6074645, 524325, 2426231, 5014289, 3693966, 1659991, 940025, 3842034, 4159193, 6615020, 6420588, 2229882, 4144350, 2505875, 1697032, 5749930, 1381593, 3021122, 2225305, 4551080, 4173606, 5254937, 3846157, 2822047, 9127, 450206, 1498724, 947409, 2394695, 5697436, 5097736, 1030118, 3822330, 6899500, 6273624, 1602925, 245935, 2214837, 249161, 3979658, 3305717, 3056956, 6095171, 1485928, 1992243, 2133759, 6918458, 7124697, 1310018, 1635737, 1054305, 6232679, 2605070, 7134861, 4930510, 4682807, 4487633, 4884866, 3214371, 5557055, 7277852, 2347636, 1632381, 1054091, 3874938, 48647, 3418503, 1589968, 1818623, 1738240, 3578748, 5462143, 1415723, 3169994, 6350631, 5185203, 4899452, 2774560, 26051, 2907442, 7316955, 507641, 3636429, 2590882, 2844941, 1603046, 6354249, 6617260, 5447388, 1768446, 4978261, 6253730, 3931406, 5203232, 5367312, 853306, 5757046, 2452326, 1196377, 4879376, 3593239, 6149237, 268835, 1744965, 4671177, 6950258, 3215620, 33406, 1226231, 2054897, 34486, 2266523, 999021, 5738104, 412064, 4996286, 7284784, 6806311, 2414355, 3628057, 3678460, 3256560, 1894215, 33320, 6974442, 3827898, 4702551, 4842856, 3608848, 7231292, 1593628, 1562159, 1883818, 5830105, 474584, 4333354, 3386783, 1348004, 5986383, 6648962, 7023119, 5615584, 4473472, 5704957, 4269517, 5065472, 5947120, 5135586, 5329657, 6803675, 3798026, 6692143, 524328, 4772202, 2859361, 3998257, 2143875, 4799152, 29387, 2339865, 1571852, 24814, 1590358, 7021732, 4374236, 4083022, 555153, 5083185, 3872619, 403502, 1236968, 3706118, 3410896, 884033, 3408250, 5331155, 2376643, 84726, 528540, 2801207, 3757115, 1636150, 3408499, 4631765, 1789912, 3089698, 6566040, 3047953, 6052308, 5130581, 6241268, 2631685, 2523086, 6445089, 7273321, 1637798, 6260532, 6642057, 6101627, 5732386, 5592096, 2583347, 3739569, 495436, 6076545, 2847063, 155611, 5923102, 5076342, 6644995, 2435863, 3473763, 2428900, 447335, 1540991, 7199094, 6843941, 1984288, 2236061, 3212134, 3304604, 4804996, 6318350, 3145604, 990456, 2427321, 507235, 880007, 2302301, 2740230, 3310196, 658093, 1440347, 366037, 4353437, 3427593, 5134373, 5307924, 7187823, 4829641, 6902752, 5054253, 716200, 4227384, 197273, 7235616, 2776158, 6029558],
    [3041605, 6206991, 3228745, 2132544, 58826, 3490286, 5579641, 5029842, 3088202, 3938224, 2214249, 1833732, 5781998, 7258111, 140403, 132787, 6739886, 3594578, 5100147, 7060767, 1451342, 8895, 4654110, 4473770, 6119414, 973263, 4599377, 1757384, 6458661, 2868365, 2892107, 5907407, 5408569, 2039506, 2241567, 3961103, 1672226, 562418, 741460, 4002643, 2755102, 6680490, 5430464, 2243118, 5935782, 5572824, 4776044, 7338057, 7324861, 7179543, 5454881, 2597776, 6289905, 3915869, 268896, 4822129, 6220621, 3260655, 3340748, 1722192, 1969788, 6275027, 2483380, 2857768, 2436953, 3549611, 4604129, 3758690, 4331580, 4770480, 5321482, 1131644, 5353920, 7089095, 49282, 6733015, 4228859, 2487103, 3624913, 3979695, 1299520, 1546631, 5805364, 2137697, 117306, 4763922, 6463894, 2139505, 1462113, 5882481, 6926233, 5990009, 5964419, 2155358, 6327523, 1959374, 3983724, 4958114, 2047333, 6713000, 380978, 414181, 656020, 6515790, 4250384, 4717043, 6233829, 4509921, 2075861, 823646, 6413961, 3313737, 1616701, 4541509, 1283634, 6153498, 1304425, 5911648, 5464604, 3666592, 1942314, 6537570, 7178846, 2008885, 3757616, 3471809, 3234572, 6895610, 111775, 6159213, 5735744, 3776580, 4250056, 4958300, 5278411, 1419168, 6960108, 3672794, 584428, 6196443, 7122338, 5225644, 392125, 5941779, 33392, 2252210, 129813, 2929214, 6129390, 3836052, 6375044, 6383257, 6423858, 6395852, 5766327, 5627307, 4396136, 7126668, 6147150, 1553058, 431317, 4361667, 586174, 5548312, 2619738, 4069522, 7028053, 5491811, 7037304, 3215159, 1109368, 1054678, 6246356, 5574538, 3892438, 2326029, 697882, 6674714, 7174007, 4631763, 7145151, 2319290, 4488714, 1342233, 7263809, 7250554, 6489903, 201689, 1604644, 2871922, 3022266, 3297695, 3140481, 394911, 3770451, 4670363, 2454968, 992232, 5474580, 4948460, 3902208, 126783, 521277, 6514068, 1481959, 3267340, 4781787, 1238950, 675127, 6254239, 7245296, 7271688, 1073974, 6341154, 3073400, 2030137, 4944807, 2886338, 5057786, 3813432, 5976726, 81898, 226062, 2433, 4016610, 5858251, 6177092, 1420817, 3706124, 3107721, 1548924, 5838367, 6835245, 1943567, 4888060, 7082657, 3402367, 234055, 1699085, 3900039, 5057180, 6743546, 3223362, 5776055, 3439764, 6015981, 3084515, 1650740, 4930002, 527583, 4980890, 254264, 4123832, 3942568, 269135, 149989],
    [1870974, 5592225, 772309, 6876144, 6682654, 4613779, 2713049, 694137, 5235007, 4723580, 425384, 2358884, 7004197, 3429201, 1880439, 99939, 5509718, 4489614, 50229, 1485526, 5607529, 3834025, 2921852, 4197081, 3932031, 5735815, 2951581, 5707704, 1061006, 730775, 5311825, 1229120, 6392303, 3114369, 1577097, 1959717, 6470284, 875548, 2199410, 2345814, 1950520, 640359, 708925, 6826792, 6196854, 5434338, 6634656, 2833254, 7058415, 3815373, 5223747, 545733, 6453383, 2503558, 5260284, 890769, 5817690, 2330946, 1475755, 6382983, 283172, 5246978, 941356, 1712966, 6834642, 4446312, 3786230, 7132208, 5615748, 5772414, 609529, 5601597, 1934768, 2338914, 4515773, 458149, 7307942, 4716134, 3277400, 4301371, 1463284, 5050973, 3736984, 5068932, 5679055, 2779272, 406162, 104283, 242275, 5255975, 6156243, 1848140, 3514094, 2386707, 4525774, 5712941, 7047763, 692951, 2143988, 2064364, 1654170, 2027912, 2786779, 3024124, 7033106, 3383336, 6901140, 3229312, 2281062, 4388804, 5532540, 6876586, 1093798, 4442604, 6611594, 579973, 2853733, 3752240, 693900, 1582581, 986234, 4155274, 4617049, 5194529, 3183073, 89349, 2510672, 731776, 1242250, 778100, 448014, 6213541, 187227, 6259885, 1212582, 6649527, 186322, 3016805, 780927, 6116565, 6262242, 7105361, 2692335, 6788591, 219351, 487228, 5135144, 4792638, 6435427, 4693916, 980362, 2290263, 7333448, 3308979, 5966337, 4723851, 5210714, 1858760, 5664803, 4562023, 6604531, 2046851, 7116125, 7179679, 5477915, 605287, 3918424, 1421199, 2762569, 1844238, 346601, 1363244, 4435197, 6283983, 2909795, 2301975, 3264418, 1032007, 820005, 992784, 3832768, 5141292, 1501443, 4305901, 97424, 6934577, 684489, 2697520, 1355990, 780412, 1715772, 3430422, 4365600, 4750423, 6946133, 1592859, 4691069, 5381520, 2277896, 2430971, 7226984, 6142945, 1872101, 6785424, 5677038, 2272934, 6546851, 6456662, 796613, 3938780, 4169823, 7158996, 34939, 3446093, 7291501, 2617628, 6731343, 1443159, 7180756, 2306329, 3547974, 1142357, 6490369, 512106, 6338119, 7079506, 7283948, 744678, 1371632, 6592682, 6505903, 3793085, 4160154, 4643289, 738219, 1054827, 1151000, 1998972, 4375222, 6110587, 4436619, 5283623, 3368063, 3610331, 2619703, 6581732, 2966027, 1883533, 5757657, 5846769, 4716872, 7008870, 2885089, 6320787, 615197, 1867691],
    [982485, 2465880, 7152044, 6287611, 604100, 4435534, 5672621, 4539325, 2527179, 1138916, 2867846, 6802383, 204705, 4107744, 6385022, 3959003, 1093212, 5620799, 7325998, 3268123, 5277519, 5099413, 2135576, 1287586, 7287206, 3452205, 2526592, 3103252, 1128915, 7211247, 1004337, 7200854, 911062, 6944794, 766088, 809406, 3710291, 1552300, 7200092, 3419862, 4936550, 2590811, 881602, 7325945, 6169674, 7204559, 6202121, 2113789, 3400417, 5888021, 2202307, 5491924, 6225512, 6975564, 4912718, 6594795, 4411495, 2468566, 5578772, 569039, 2192420, 3970222, 2424031, 452993, 4656357, 2186544, 2973324, 4829238, 60338, 3542741, 3685187, 6267651, 822863, 3491514, 560397, 7058355, 7027148, 939500, 658121, 3505898, 3571315, 2943193, 611032, 5523994, 5272834, 7266905, 7316120, 2841738, 3485906, 4165993, 2687827, 4064323, 135687, 4623580, 4032128, 6802196, 2572310, 6926654, 3911907, 5548461, 3151479, 4590044, 3976383, 6062142, 284660, 6846712, 1824033, 3375958, 1014286, 1005023, 977029, 2479492, 3473698, 1339087, 3849114, 4998033, 1965851, 3938163, 2400069, 1633062, 6956683, 3302999, 1566520, 6910989, 437938, 620364, 913726, 4940575, 4635082, 5892334, 6696178, 7031176, 2388479, 6244923, 4115912, 6906912, 2533838, 6667589, 4976610, 1200409, 3059358, 2154964, 4041667, 1617791, 247503, 6589726, 6204325, 1515409, 1525069, 3676763, 2828345, 2378008, 4968256, 5832331, 6509590, 1993290, 4942518, 5841425, 3425214, 1499480, 4836458, 5937500, 849967, 1543404, 3090615, 811217, 6808101, 5789892, 772004, 2283358, 571566, 2592090, 4417823, 6663531, 4589595, 3971555, 3942704, 4453387, 4687220, 201203, 5816325, 1845893, 5383721, 6141284, 713939, 570687, 3761607, 2147188, 272227, 6374711, 407628, 1863978, 118598, 6542500, 913782, 2945613, 2351476, 6155797, 3797836, 1866465, 4002929, 3326144, 4466575, 4168809, 5566204, 4648149, 3920699, 5405230, 4515050, 832203, 1044393, 410427, 3943460, 2329533, 6697397, 4445589, 2203815, 4844630, 5848874, 205359, 77969, 2766150, 4521761, 2218308, 490049, 2937503, 437676, 2112807, 3746329, 4051940, 7084365, 5611451, 6606711, 2705233, 3120801, 532303, 6497910, 2316454, 1568005, 1298522, 6431935, 950609, 7060878, 721740, 4551377, 2430736, 5964118, 2977128, 4187517, 2255241, 5702100, 5238048, 1961422, 6629436, 5616692, 4265188],
];

const PUBA: [[[u64;N]; 4] ; 4] = [
    [ 
    [5090055, 5624936, 2867677, 3806219, 5432445, 2362735, 2646561, 1337974, 3933593, 5725838, 114130, 2083729, 1097819, 1091693, 620899, 4504786, 199595, 5461284, 1987227, 6205831, 6280809, 4909753, 6649265, 3328796, 7071189, 4473916, 3351552, 99345, 7135919, 6487466, 1665467, 46426, 936269, 80514, 4539726, 3094469, 1992293, 5653083, 5279180, 6752505, 2237658, 1458589, 3165175, 4869179, 4534190, 2277394, 4380780, 5834864, 4334820, 4003663, 5959164, 7016565, 4865285, 2063679, 1877122, 6200699, 4999319, 6597947, 209865, 6908212, 5336404, 4845159, 5079553, 233735, 7166766, 6204348, 4050664, 1634888, 2177782, 1971987, 337287, 5014632, 2476732, 6398138, 6100497, 6053087, 6288530, 3720225, 7015246, 1243938, 4165148, 133037, 423732, 5233344, 1256781, 2233591, 6777455, 6936802, 5284505, 1566996, 6737035, 2609030, 5455322, 6289376, 64711, 4365543, 323965, 140628, 4769255, 486476, 3259302, 2598154, 5641490, 996892, 5377822, 5809670, 5202530, 160809, 6626270, 1117734, 3129609, 3641761, 1334244, 3111244, 6289555, 7017131, 3643583, 2766441, 3707637, 1310932, 6842909, 3090004, 4023799, 6419561, 1986757, 6986435, 2204437, 919901, 5971901, 5277578, 3334190, 3020118, 1527013, 24043, 6724227, 3865533, 2479298, 4742175, 381356, 6371951, 5542627, 1428263, 3280665, 6128049, 3585094, 4632296, 5115166, 3056152, 3880743, 2070660, 5293281, 4665687, 5863289, 3387899, 2498039, 5040240, 4330384, 3100591, 1233893, 1941167, 5882981, 6528350, 1000049, 3614418, 3851471, 2440151, 5455086, 7210338, 2245020, 1646184, 3126397, 201595, 5987665, 6232569, 2325236, 4186726, 3428814, 293685, 1318599, 732208, 2386959, 4429305, 3923058, 4142331, 6602411, 1468309, 6211855, 3676671, 2820666, 4717588, 7233242, 6122327, 7275283, 3293326, 6676875, 6456283, 7227048, 6647602, 3941557, 872715, 5743825, 4183381, 5821342, 271828, 5895270, 4849639, 4047265, 4136207, 4923537, 3277078, 809200, 1908345, 3177861, 6935611, 6957714, 1356440, 2698645, 2417072, 1302230, 2494035, 2883509, 6045383, 4970239, 7280044, 740972, 604717, 3338307, 1616589, 3171438, 4425571, 6782373, 2158426, 4362309, 4092158, 6047456, 6112090, 3538527, 270461, 4510294, 3590365, 2505142, 4966547, 4698697, 4228680, 2264480, 4295982, 3545202, 3701421, 2889037, 5817324, 3272302, 6668131, 3431018, 3169830, 4559359, 6349616],
    [2056516, 2813503, 4481701, 5688642, 3516375, 924976, 6495456, 2842143, 4570974, 3182631, 3954656, 5131864, 5946626, 5108013, 5784745, 5431373, 6056548, 4916535, 6090916, 4686962, 7229273, 1060226, 3504276, 1011115, 258835, 448994, 5418784, 2147359, 1141168, 6903726, 4710645, 2989298, 6360825, 1518348, 3867026, 5703832, 2898759, 2207174, 6047058, 5071917, 7080739, 6907050, 2535260, 4498020, 6023321, 7015499, 4932295, 2489646, 7247679, 6432680, 2321023, 66959, 4959788, 5109649, 5736225, 1261060, 6414255, 1696008, 4114599, 2260847, 3755879, 6997362, 2178191, 3119110, 972164, 3124236, 5292271, 479964, 1860001, 729487, 4048934, 6350813, 3946543, 5178344, 3618139, 2021897, 544971, 4235457, 4612178, 6768868, 1271187, 364570, 6967120, 5817714, 4455721, 5712718, 2551140, 2285466, 4334908, 4456833, 3321712, 2978167, 6185377, 4367902, 5555703, 4780821, 6618521, 4375446, 5165795, 1425863, 4587557, 3404064, 5724337, 2943942, 879408, 5679224, 6364177, 2629921, 7137247, 4301785, 1972040, 781942, 815752, 326159, 6007074, 1189835, 4000854, 1170861, 4366244, 354738, 3696561, 1117673, 6911193, 4680094, 3522884, 4683906, 3542668, 1243955, 5405502, 3784245, 551985, 6421595, 2554087, 2997624, 1417297, 6782408, 5250136, 1823888, 2762467, 1865804, 2227906, 6649823, 999602, 6098125, 6803222, 1632788, 4933582, 408677, 2203757, 806982, 3350800, 7288996, 3055157, 3890319, 5123448, 1660866, 1902027, 4565661, 7002154, 2500301, 660072, 2877334, 1701522, 40539, 2668826, 1831991, 2210688, 3517832, 918555, 2042965, 3947558, 4023216, 7288247, 2517966, 553719, 2630421, 5958201, 606584, 1456962, 2006948, 1765841, 5976157, 4586485, 2444219, 316158, 4788034, 3909159, 6731767, 2710416, 6588283, 1804402, 211911, 359972, 4433876, 1498710, 3224616, 6728208, 2192209, 1482499, 3003259, 537699, 4813371, 1690754, 1139914, 4831865, 1590684, 2587996, 3023361, 4931291, 1123986, 670100, 2812046, 3337824, 6735784, 5441540, 2495870, 773187, 6226823, 4835427, 2570524, 103577, 2236076, 1509487, 2902453, 7177590, 1467500, 42454, 4136627, 4766606, 5381314, 1210764, 3531624, 2498165, 4417704, 3434118, 298720, 1820401, 1344138, 3729946, 4055476, 6845596, 2625180, 5565531, 25109, 2114522, 2520500, 2549924, 814709, 6461162, 5398360, 727369, 6371722, 2631685, 1101822, 2621465, 622580],
    [4105797, 1525317, 5071062, 7069891, 2636252, 4489262, 5124500, 6638847, 3113176, 3343604, 3933063, 416349, 5352840, 6817190, 1737293, 6518052, 5968660, 820089, 6552144, 1995027, 2222211, 1289437, 1646064, 7112744, 1365392, 1979198, 2007395, 611334, 3453130, 7308751, 3582120, 5905751, 3092140, 4094119, 556780, 5378220, 6019431, 2331708, 6532069, 131426, 5724659, 6014917, 6569096, 6608698, 2112103, 4603300, 7279591, 3250080, 116142, 5188618, 5998123, 706464, 2928395, 3043697, 5922041, 5417040, 6162314, 2227679, 6823188, 7289559, 2193025, 1152256, 463203, 3964445, 3185873, 552149, 277598, 5018054, 6029980, 660055, 5374843, 196353, 3227354, 2414798, 4166573, 6600040, 6936679, 6713979, 725349, 459618, 6841883, 3646699, 2640454, 1948067, 1792810, 3674398, 7303810, 1611394, 5634378, 2573749, 6049276, 3228614, 5837257, 1966609, 6386888, 4975546, 1440123, 5582880, 846085, 1251742, 6872245, 973996, 2995064, 4145233, 3780092, 4292472, 6695519, 2116574, 5972427, 4621098, 2989789, 6213259, 1027078, 1175708, 4279220, 5978440, 7030443, 5561544, 1009197, 879478, 1825937, 2378586, 6741101, 5421922, 1571618, 1724950, 5291536, 3632201, 7130731, 4969616, 778775, 1111404, 1388108, 6127284, 2286445, 5485568, 3642819, 7136348, 1897206, 4345481, 4660468, 6847639, 5886798, 2979810, 1943056, 1055311, 479756, 4627420, 6765453, 4850900, 6746814, 637263, 5901106, 2141171, 1189388, 4418078, 3635588, 1790489, 2516380, 4067206, 6103966, 2155727, 4248363, 1418575, 1424950, 2648133, 2799353, 1481582, 4825342, 4366347, 4454193, 4903900, 540941, 1899968, 542516, 2613750, 6899894, 2097407, 2796726, 7241429, 4226920, 4200003, 3828078, 346422, 5401600, 3439276, 4845667, 4500819, 3134593, 5716959, 6817359, 686761, 2770670, 5126244, 5952531, 5197859, 6656884, 3615698, 3587384, 104898, 311409, 4462570, 1227082, 5227595, 1865632, 3591465, 2177654, 4699495, 1138459, 7213585, 2750754, 5529950, 5394751, 208007, 848581, 385654, 6526638, 3958149, 6496552, 3593831, 362071, 5275112, 5760908, 58160, 4669341, 6651409, 3285589, 672369, 7316184, 4276145, 1364212, 3933149, 3593042, 2735400, 5165380, 4087878, 3771527, 2848428, 240449, 6624749, 6588001, 6090543, 3606850, 264818, 3369517, 5737690, 899655, 1918145, 995418, 4136079, 4461590, 2806976, 7027595, 6581193, 4883897, 3783651],
    [1059718, 2355023, 5117961, 4506301, 3562701, 3675724, 6367410, 2481382, 4580750, 6885845, 1557693, 3319023, 6301863, 3137309, 1105491, 3048359, 1377998, 6664705, 7287967, 4750268, 7146546, 3663816, 3061881, 6908634, 6303165, 3971894, 412174, 6284018, 3747475, 2996751, 2509971, 3726794, 3211298, 5089726, 634111, 7128333, 6951878, 4975651, 4200880, 391755, 6696914, 5231257, 2468714, 3660076, 3181693, 764239, 416212, 5507286, 6317185, 3101771, 2272302, 89136, 1789029, 2912988, 166167, 2006112, 7146252, 1806394, 5098243, 5640301, 4737248, 1784595, 1011106, 5666928, 203082, 3560609, 5016571, 1782044, 1760612, 1791231, 1458850, 5765746, 6420548, 4801934, 2515493, 5024146, 359659, 1331894, 7076657, 6976332, 1907609, 91934, 4689241, 5644569, 3432500, 6101252, 1850922, 5169322, 6507900, 6740809, 5215598, 5364275, 4746369, 1820792, 930927, 468827, 4012337, 6899749, 5725668, 4493519, 6067394, 3639133, 2500165, 3027752, 2590122, 7181092, 6676660, 1683376, 6425989, 7237335, 2911133, 6333851, 5273088, 5545611, 4368531, 770922, 5191086, 7207077, 6539447, 817413, 6356324, 4942734, 3558144, 4858040, 5450214, 1002898, 249894, 3163256, 3269575, 3278055, 6921731, 3973485, 3518180, 1882892, 2536913, 1231579, 7079734, 4461848, 7223406, 174819, 3860847, 7272062, 6509984, 1855131, 4911845, 928941, 3202215, 342525, 1803941, 867797, 3300516, 3175683, 302217, 2247371, 2002161, 2140110, 3902605, 370225, 2845528, 672265, 4141095, 2007568, 5768926, 5806327, 1084911, 2353492, 6906286, 2817784, 4213713, 3986750, 4475489, 7232984, 1162118, 5386314, 5988971, 4618603, 5433136, 2781045, 3964072, 936668, 6795217, 2148051, 3122459, 1494017, 3548205, 7191867, 6220682, 5363681, 1381276, 3232302, 3505453, 178015, 1235538, 1308687, 5785343, 3997792, 2289302, 572123, 160050, 5800620, 1046978, 4484841, 4409095, 2902615, 5176012, 2052941, 5803076, 2795367, 3967104, 5600941, 3314362, 2714121, 3379845, 1363744, 906799, 3846485, 2249262, 4397296, 997549, 2602274, 5079458, 5622816, 5556750, 4768444, 6731328, 3748678, 2595535, 4805852, 5043944, 1569952, 5348238, 5572634, 1812987, 2218721, 1603235, 5231140, 5038289, 4634407, 2073938, 3336646, 6523133, 4052911, 1675172, 2975297, 2743858, 3146267, 2943893, 158688, 3720933, 620085, 4549817, 2890528, 3458623, 471049, 3845993, 6384276],
    ], 
    [ 
    [6607978, 1812935, 1823219, 4236211, 1888221, 328243, 4582181, 2990847, 5092549, 6155753, 3956165, 3650377, 1422984, 5945145, 5526622, 1251362, 4699910, 5368760, 1813629, 1026356, 4370750, 2900206, 2604245, 2893276, 3104646, 5979377, 4368279, 4126513, 3319590, 3937165, 6323152, 43623, 6995719, 5321430, 4470531, 5218880, 4053637, 7252851, 5318786, 1084917, 1587757, 5378259, 3764179, 5791784, 297058, 4290568, 7027021, 5994163, 6981141, 4144020, 4154845, 1112191, 5592267, 2942954, 6515883, 764119, 1924895, 6514784, 1333362, 5023531, 3581826, 3365492, 1498294, 4857852, 7195630, 2014809, 3227554, 6631377, 5184369, 6182799, 3832886, 4879779, 4354265, 3659184, 841066, 6885740, 5649089, 5515260, 4969193, 3072203, 2864230, 6740583, 5129177, 4033615, 4410232, 5024605, 7130376, 3690437, 3604859, 6191720, 6372652, 5721103, 1502539, 1694570, 6753472, 828142, 5309831, 2771089, 2273415, 5654684, 1130480, 6839356, 5119627, 1444490, 3541816, 1603586, 5043761, 422069, 357032, 3222990, 7101895, 3288095, 2271904, 4226965, 5672132, 6745500, 1892218, 3069966, 4000297, 183098, 5178722, 5839682, 173125, 3123411, 2421857, 3866434, 889312, 4902043, 4548117, 2624663, 6504750, 2780423, 2224178, 2421152, 4222713, 3588728, 2365035, 6929288, 5373164, 22328, 4755739, 6517059, 1631933, 4564593, 5624807, 4978261, 3071587, 2211925, 5922272, 3224495, 2708870, 4985491, 1228697, 3141583, 2300082, 435059, 4198237, 3969535, 2232672, 5803332, 2016067, 2890472, 2427213, 7245521, 722780, 6848620, 6933409, 557436, 2811412, 1482737, 5814185, 2667397, 2679401, 3383948, 1577168, 2879919, 7154616, 2881605, 5076572, 1462126, 2832254, 4014699, 4156513, 1927040, 878321, 5184838, 5199853, 5899823, 1427908, 1311410, 5410260, 1851989, 5448265, 2686010, 3400773, 2843682, 5435845, 5992362, 7003786, 2358182, 5535532, 6652986, 7155904, 4002727, 6761205, 1533232, 4094209, 4785285, 4206836, 4295487, 1982429, 5038436, 2126344, 6978937, 2434305, 1820997, 2757191, 1719020, 6677681, 3588876, 2479268, 5515299, 3326853, 4413693, 2268047, 1994086, 4175817, 1438721, 7202874, 5495491, 1726062, 6165747, 202624, 6306278, 4322679, 3151718, 840023, 6890281, 4797961, 4885032, 4847690, 2517364, 713042, 3128041, 186886, 313285, 905745, 1209365, 3196878, 1275349, 7144101, 3748200, 5343198, 5933441, 2514319, 6607084],
    [6792235, 4769739, 4043381, 1541463, 4295419, 193436, 5467265, 1561399, 5639579, 5599131, 5733568, 2415603, 2459638, 2098948, 6295891, 337147, 3314175, 2738249, 1584905, 2510087, 3808306, 2584690, 639136, 5928456, 6817645, 62706, 6455433, 3552346, 5568381, 3451386, 6876593, 2791689, 355210, 5858307, 4011822, 1497230, 1928725, 7108973, 1314781, 3563642, 3288596, 124194, 3700450, 2275099, 2184082, 4026683, 285551, 887088, 3838923, 2657027, 278801, 7237379, 5137214, 1222635, 3526365, 1910816, 6144760, 1731756, 4237007, 5517232, 6756064, 2909056, 7197078, 278268, 4379095, 2765184, 2366718, 1928035, 5217406, 1915737, 2355257, 2242867, 5885892, 5174986, 6844662, 1116417, 2908323, 3830289, 6925960, 7280311, 2182958, 6317545, 6993744, 4115590, 3657391, 1333158, 4989857, 5955476, 3048288, 4326864, 4049875, 4736173, 6174345, 1079560, 4904342, 5339415, 5103368, 2348871, 5130054, 2425192, 4433774, 1578748, 1476505, 1095673, 4032283, 3065499, 2515744, 6372445, 625748, 2537759, 4158797, 1269973, 3411175, 1678043, 4119068, 2167693, 587454, 5916244, 1344638, 3164300, 1336530, 2121804, 4482310, 1911261, 2082018, 2355562, 4011891, 120433, 4415213, 6128960, 2812950, 6564681, 1956379, 3281611, 4669348, 3588914, 6251075, 1793608, 2394366, 372058, 4560400, 4452118, 4239771, 6569831, 2523180, 2407581, 794993, 2933000, 5777650, 1723196, 278404, 2548956, 1073864, 6716669, 801003, 4041541, 3766738, 2004294, 1726762, 1301666, 719997, 6986196, 6533670, 5083053, 4144268, 47480, 5262337, 130945, 3844798, 220666, 1690473, 6822555, 3546710, 6800112, 935384, 6492365, 5372459, 3922182, 3523481, 1296724, 4801659, 1439611, 2441015, 5605023, 4473806, 2683057, 4226147, 3006296, 4648941, 3003770, 1353882, 7280816, 5270112, 59371, 6265129, 1718935, 3997958, 5691222, 2830675, 6200640, 208814, 4007860, 3488507, 1397667, 5214075, 4666646, 1071056, 6855501, 1117461, 5240484, 782835, 5309499, 3492085, 2218617, 979805, 2863055, 5745972, 458463, 1166654, 3403490, 2597107, 6137056, 5900126, 2389864, 2232997, 1135656, 6439905, 4745772, 7020660, 448467, 2809209, 5456171, 6522730, 6242966, 2173957, 2807297, 2551429, 4378001, 3830010, 4763003, 5405813, 4354999, 5477733, 2649420, 2993871, 4752948, 2387947, 3020763, 6933064, 3336193, 3739401, 2668726, 3730872, 5407139, 915676, 4795859],
    [189688, 4586739, 73671, 1558570, 727877, 5646417, 4658535, 3835710, 551836, 976041, 5564368, 933314, 5244140, 5190058, 3049636, 6040918, 3841381, 1178859, 3017371, 6948179, 4833564, 4748792, 7138437, 1222651, 2371942, 2538328, 623721, 4656727, 5080537, 2627997, 6161417, 6214405, 3325102, 683127, 3482649, 4388665, 2944948, 1548389, 3198372, 3450695, 3733544, 4708050, 1750474, 6943013, 6649100, 6924675, 3443578, 5914104, 1513508, 4137780, 3602364, 995762, 2948913, 2847269, 1331755, 3040627, 374764, 5231725, 4189894, 6973183, 2014199, 5145847, 1538562, 5275072, 3017146, 4967874, 7237055, 3090286, 4911418, 6941480, 4307740, 1133166, 1742698, 2558096, 2806741, 6919567, 5783664, 6894646, 3382941, 5718225, 1928589, 5710053, 5518875, 633025, 1974143, 6634195, 2609909, 4359879, 3660031, 5351348, 4911480, 1463216, 2691543, 6711050, 4501241, 5146233, 2207917, 4876525, 3790445, 6141510, 4570914, 1817446, 1597133, 5863766, 4673654, 2454429, 3064369, 3573516, 1672370, 4577695, 4511662, 5660455, 1951409, 5445516, 5722154, 3188171, 3683510, 3699959, 856486, 1999497, 4278345, 5138275, 489471, 559411, 3870034, 3526980, 1867677, 5852802, 2043809, 5719703, 4939690, 6338981, 5506893, 447384, 6248969, 534571, 5980790, 7324125, 5431561, 4921231, 1465131, 3791564, 6637307, 5903137, 1525791, 321887, 471351, 776764, 4766335, 5902348, 2593818, 5729688, 3305741, 4517727, 6375979, 904368, 3454430, 4107105, 2134730, 6748274, 238660, 3512032, 4158245, 6744267, 2388469, 2683703, 2349034, 2048807, 1289839, 28331, 4961628, 3598370, 3297626, 5279748, 701838, 6502145, 4420436, 1801432, 3118934, 6680922, 4357261, 6017332, 5913815, 1550175, 2018008, 6339834, 6658992, 2432636, 3808081, 5476651, 4988777, 5319319, 676291, 5207363, 478414, 7192724, 6563239, 4632429, 7275863, 1676744, 469686, 3776617, 5540532, 5068613, 5361359, 7207432, 3580045, 6154102, 577455, 3102335, 6933371, 4481254, 6808479, 6190515, 6736382, 671225, 204192, 333195, 1802431, 3889264, 818385, 2127581, 1244492, 6999554, 7334222, 4899282, 5896746, 1741952, 560024, 4734617, 2259464, 2212571, 5488480, 4902435, 3554360, 3758693, 3296418, 3339511, 1413910, 985254, 4009667, 2696928, 260923, 6360059, 7000841, 4938081, 2516523, 770673, 576998, 4698796, 5021660, 6948825, 2486696, 7212245, 4654464, 6915030],
    [3826895, 5898858, 4054410, 5834094, 7146276, 4310657, 1939959, 5412314, 1137083, 3591290, 615762, 1699758, 3044251, 4589517, 263435, 6001277, 2449513, 608208, 3814189, 5764104, 7110934, 2880421, 3653235, 7144252, 6638310, 6112204, 202831, 1529632, 7039537, 58951, 1302268, 4195404, 6036727, 6679810, 5085542, 1390435, 6632131, 2872040, 2777461, 479010, 1765409, 5761790, 6950515, 7010551, 1624812, 612261, 579079, 32574, 4818237, 2849069, 5893543, 6640858, 4885372, 156173, 1712196, 1092194, 1892365, 3531621, 4383358, 1756559, 2324045, 6794387, 1351447, 4054998, 609536, 6059595, 4349831, 7232952, 379994, 1305379, 593710, 6332991, 6810252, 177095, 2242387, 6377014, 1211857, 2433019, 1247706, 6110733, 1761803, 1525016, 7148468, 5939312, 2228147, 3527523, 6654768, 901184, 5088281, 7062135, 3273212, 2363232, 4065470, 2060318, 2844244, 5840787, 745896, 5563640, 3836140, 4056947, 7307143, 6647181, 933698, 6417907, 1183746, 6765397, 123878, 618221, 2171555, 4068869, 4232834, 1356620, 5205246, 2515890, 4707606, 5712976, 6207245, 6510022, 6563788, 3898479, 5883098, 2542086, 7188923, 3401189, 5755327, 984778, 6912395, 6774121, 4317295, 5012794, 1018880, 3306302, 7091860, 4182014, 5679638, 1222321, 3013245, 5821617, 3909472, 5865521, 5201660, 4421639, 5954916, 5945838, 43218, 5722798, 3326914, 2474632, 5439023, 3029565, 922325, 3883668, 757194, 498933, 6502863, 1810379, 309910, 53544, 884340, 6158165, 469487, 2648137, 2290652, 1816716, 3488559, 6391658, 1392787, 2554887, 4372954, 1592384, 229334, 7207952, 6315224, 1191241, 4600171, 6292719, 6781913, 6780350, 2709132, 6735974, 1652827, 4493906, 6049223, 4441660, 794479, 6857953, 6167077, 3503668, 6110730, 369948, 4528914, 7137418, 5984686, 6731938, 2750531, 991185, 1367195, 24152, 2078158, 237396, 9604, 2052412, 263453, 5438434, 765146, 1665221, 5286425, 4590350, 5324151, 6156088, 3879024, 5246378, 70378, 7299743, 4023626, 62052, 4578814, 2034664, 6220757, 2401214, 6422518, 5667593, 5788802, 2235321, 5547970, 3703236, 6561176, 953261, 4042166, 6136169, 2863811, 1492460, 773228, 6862492, 4143022, 1591784, 2355699, 2415526, 1972064, 3146214, 774886, 7228946, 6326762, 2555898, 5631680, 6589728, 6980360, 5622065, 4600516, 5931290, 862258, 1885938, 1431604, 443122, 4640464, 5864286],
    ], 
    [ 
    [5172541, 6764212, 4457460, 901495, 5656718, 4333952, 1947238, 3009884, 634859, 4598079, 135999, 3935154, 7191078, 489697, 3837708, 3934644, 6280474, 5150886, 2088264, 5709972, 1062850, 1227521, 704696, 1422377, 7100778, 2480544, 2039851, 1280236, 4153313, 6015425, 5847395, 2925002, 1724509, 514875, 1609061, 248130, 6464568, 6171225, 5635217, 5480533, 1353683, 6438365, 7207793, 79690, 1824984, 1698481, 5304898, 1692844, 2093581, 3319037, 1051766, 2013375, 4761611, 6427295, 2289516, 1085657, 5533910, 4165024, 6965471, 3366524, 5622279, 6105020, 7224306, 2401703, 814521, 4926853, 3251531, 1233952, 7291153, 928219, 2776692, 5809069, 1181989, 1050226, 5327259, 2201956, 2469064, 3670876, 1453969, 3801106, 5400036, 260863, 3548188, 5082828, 3300978, 173968, 3113686, 4755400, 3875776, 4407934, 4277992, 2673762, 2930501, 3777934, 5877581, 4102267, 2835176, 3769475, 6160176, 1445632, 3126905, 2793930, 198032, 351287, 5095002, 2424000, 4552799, 6962467, 6006724, 126155, 5131844, 4215637, 5367307, 6359740, 2793086, 1728271, 5189952, 5835363, 533388, 3841965, 710446, 3492007, 6774163, 1332514, 3570579, 1488623, 5309970, 6916037, 3250683, 6577916, 2602250, 2285659, 5066271, 2840901, 6568361, 2497607, 2304309, 5607799, 926527, 4598655, 6495557, 5908068, 6723514, 7168539, 1993327, 5434708, 6106079, 488750, 3246834, 2736256, 7306589, 142213, 5366203, 79199, 4101198, 5233392, 4737225, 957210, 5128016, 3710681, 7263346, 872885, 4944422, 3822483, 2291006, 2636089, 5681398, 5210830, 763837, 2840393, 4558498, 5465352, 4888931, 1668778, 4087800, 2728628, 6809156, 6628855, 3021532, 6351625, 3267688, 2965161, 6688478, 3438292, 4616712, 1701729, 6477330, 4010494, 1408246, 6329065, 4202950, 4378927, 2593, 2304972, 6961999, 937620, 6690377, 5406185, 2596676, 4533292, 3301439, 746862, 3899198, 3348614, 3769256, 4554356, 2496863, 5807261, 92980, 5900940, 6328484, 6408287, 6951393, 7112271, 1444317, 1111618, 4221468, 2561093, 6232302, 7001844, 1416222, 2661871, 209797, 6068547, 178221, 620058, 465514, 6952976, 5115888, 3337988, 3015239, 6088540, 2762983, 479035, 71546, 2067180, 3310705, 4764853, 6473854, 35926, 6942724, 5482816, 5153332, 4938622, 2903266, 3438222, 4228013, 3799926, 3228280, 3798405, 4505606, 3935415, 4868684, 4444317, 4924458, 6913304],
    [2630038, 1198344, 4158952, 7213989, 4866122, 2343462, 593017, 311487, 2802278, 102868, 3828036, 2711476, 4778133, 1826981, 212689, 5875091, 6901932, 3818257, 1365285, 4282480, 7163094, 2708196, 3133497, 3005883, 2880513, 5636544, 3322002, 2099477, 2122921, 6462501, 3363272, 2057224, 2318537, 7253991, 1102908, 2265017, 2853896, 3650542, 4684814, 177742, 6093089, 5206200, 1025399, 798474, 1972385, 3908220, 1237793, 6547339, 6052046, 4920822, 5393002, 3784161, 6675970, 5098685, 1399376, 7320521, 3117634, 2223100, 3140486, 2012004, 1478405, 2960147, 288, 3257337, 3809153, 6930694, 1551155, 2384234, 1977708, 460311, 3258967, 4586544, 2391252, 6139138, 3264912, 5277205, 2191874, 2490791, 1900750, 6816055, 3066397, 4240500, 3187383, 3189784, 5566639, 6165854, 2654759, 73673, 3497890, 6038233, 5429013, 3567860, 4862767, 959328, 2188725, 1852800, 5305976, 6677562, 7054224, 6283513, 4470840, 1976831, 2719556, 7029858, 7251481, 2688968, 3981650, 2807382, 1833134, 4297348, 5992643, 3460030, 445883, 1734976, 1428812, 2284617, 6855195, 2292784, 4757514, 5543772, 7321755, 3241007, 348349, 7174918, 6318454, 1475564, 2909041, 1036313, 3441963, 2860505, 4153894, 2514438, 6654621, 2686235, 2299170, 698832, 936975, 5992324, 1145513, 3927854, 428182, 2539104, 2162244, 3215337, 3657978, 3446399, 6042654, 1292884, 1806720, 5817150, 3808762, 1389978, 5953951, 5645841, 1392029, 4312509, 7118645, 5232818, 297474, 912049, 1877942, 305370, 323862, 6445712, 144056, 3488154, 6300902, 2120357, 6920937, 3534524, 3713963, 1928026, 2394217, 2377485, 4468487, 6290836, 7077948, 6717258, 4486922, 6669594, 5419310, 5348521, 4332767, 5717022, 2341994, 6012941, 4605139, 2767333, 6324262, 2380165, 4874370, 110569, 7019907, 2364723, 2244374, 5433628, 5935738, 4180655, 5672186, 912899, 2518552, 6894830, 4980419, 7036994, 1440054, 7014904, 2319323, 4048827, 4390244, 3702979, 1368635, 3300601, 6350473, 3195990, 4622635, 3473362, 232322, 6312417, 1722671, 4157800, 5612595, 5721585, 1813675, 2335534, 5553255, 6520697, 3338105, 3090996, 4009237, 704724, 3413847, 2771640, 2472822, 3441644, 2537391, 2687271, 686904, 6111281, 4665491, 4575139, 5162241, 5149813, 5250706, 2495939, 156655, 1575341, 1841268, 2889129, 6438753, 7218961, 3214911, 1596260, 1608628, 7258973, 6781608, 2773760],
    [6183800, 759306, 3359128, 6106209, 5701051, 2316165, 737841, 1077868, 1100829, 1943329, 6742501, 6609037, 2268978, 1479396, 6858980, 396200, 4555099, 6923490, 1190060, 4742877, 3776083, 2480876, 6681239, 6412862, 655492, 3937381, 5962291, 4686467, 7138365, 502419, 6572888, 3236675, 2050546, 5210308, 704927, 7257776, 1537234, 1393625, 3832476, 470580, 5899528, 4358067, 5515567, 6094297, 2315383, 4171178, 6704441, 3913825, 2814472, 549625, 5749682, 5144520, 2061606, 6498705, 2207302, 856015, 3844078, 2930254, 4318611, 6292192, 2695441, 6471644, 832407, 1972831, 6144032, 5163437, 3888422, 2880973, 2749698, 6724095, 5427557, 5339746, 6154436, 1821758, 4797296, 3475669, 909907, 1691304, 2566026, 2093894, 3603248, 5298849, 6921478, 4556913, 5923302, 4612649, 6120779, 6549279, 2205309, 5162652, 2633442, 4432907, 1541986, 2692558, 192294, 2726267, 615238, 3613662, 3385680, 4623206, 1840833, 5244678, 1311007, 6238290, 20966, 4910000, 5022475, 2926858, 5894009, 484611, 5894874, 4119411, 5453024, 960426, 2051620, 2885676, 3661209, 1049279, 3279272, 5765932, 308482, 7146764, 4791969, 4068197, 5108488, 3271056, 3251783, 4394025, 7012169, 2797961, 4488383, 3141654, 3202011, 6554156, 4034405, 7020624, 5342421, 5527683, 4228002, 985168, 5966750, 1306560, 2650277, 5526495, 5499173, 6417732, 450462, 4536418, 223606, 3343469, 7058783, 3981183, 5029093, 5944512, 7123885, 4451435, 6623565, 6894334, 6204471, 5767593, 1580459, 1366142, 3961226, 4625732, 2116121, 2541113, 3860261, 2503335, 5180516, 2054417, 3451728, 5400200, 781750, 1931126, 1153855, 6537999, 4756065, 3617459, 3666425, 2961596, 1933289, 4732823, 6034896, 549057, 1582356, 6487100, 5823670, 2737384, 5009367, 5727604, 972063, 121946, 5305225, 2014801, 4273914, 4185841, 6112685, 6622674, 6245615, 3124652, 2040096, 1211974, 851884, 5032416, 6884, 1032550, 7268927, 2163952, 6439562, 3282328, 7240781, 3943875, 5834193, 554567, 4824995, 5774331, 4469183, 4916610, 6964615, 6228036, 3809970, 2646388, 5397079, 1401011, 7039050, 6169199, 3908852, 1752639, 4057944, 4263383, 5958705, 4654348, 1193075, 2525823, 293074, 4896891, 4881211, 6270246, 2894145, 1709973, 3225592, 4380345, 5376466, 329164, 555827, 2138628, 2000520, 4662737, 6020659, 4783205, 4997981, 4507336, 5357982, 5219741, 298670, 2587361],
    [6382016, 364553, 4692099, 1650519, 2210751, 7136227, 4816957, 2005768, 985096, 538988, 2701220, 6458211, 2755033, 4008436, 6737240, 2564692, 3703562, 2080538, 5272055, 6395220, 3686679, 804515, 644101, 6907813, 2965174, 2353009, 401405, 7020376, 5784269, 5197037, 933285, 3069514, 722015, 6113858, 6251746, 1724940, 804127, 1074192, 4341069, 3817327, 5461098, 2619005, 823852, 2632185, 6202789, 6851304, 5296361, 1416054, 1094365, 4722929, 5893252, 3960998, 1169738, 5350592, 747087, 5128575, 204259, 1399306, 610103, 3018260, 6395151, 7229756, 635255, 1788017, 135700, 6802977, 3690211, 3852986, 4310033, 1290279, 1147879, 3706524, 5785901, 1948910, 294656, 1011501, 1907664, 1327274, 5760350, 5164759, 4259697, 918179, 5708955, 1680228, 5199203, 6960885, 5413622, 6693524, 3192389, 1823387, 2379496, 2136914, 7111433, 1139577, 1633367, 6687100, 2899650, 3167057, 4409813, 2367121, 4701349, 2302748, 3576854, 3418040, 178699, 3361425, 4582178, 580927, 590964, 2473854, 357461, 7146549, 6910563, 3034646, 2701565, 4312685, 4134207, 6845333, 4054856, 4220616, 2984899, 1731699, 174413, 3833591, 6766873, 3014052, 3365732, 6672804, 4672101, 6179698, 4798864, 5906573, 90050, 2386083, 2435677, 6858381, 787644, 6591484, 4854241, 3629553, 2461540, 1773469, 5936943, 5791203, 658436, 5893132, 600761, 515484, 5366726, 1327884, 190407, 1572339, 796962, 520895, 1007522, 3354557, 3492662, 5541217, 5412279, 209460, 4715674, 3008767, 776431, 747682, 4566008, 25957, 7176952, 1037678, 4393837, 5957087, 4985009, 6539188, 3510660, 5000455, 2461773, 3281740, 4554198, 5381919, 5919370, 5003271, 146589, 5302078, 6253860, 5361101, 1311781, 5830870, 1235969, 7129660, 705062, 7061476, 6783851, 5473212, 3263450, 5954240, 6049083, 3530087, 5440800, 1922540, 5711240, 6537372, 5585712, 4068585, 6020214, 6355418, 6132664, 3653759, 4685933, 6756176, 1614398, 2942986, 6434728, 7207484, 4515225, 898601, 3656295, 2492110, 5132669, 215894, 2122708, 4999989, 3736494, 6008681, 5020269, 2944197, 4418253, 6195957, 5706, 4875182, 1011318, 4369167, 5260142, 7282313, 3954028, 5590682, 6048431, 1117020, 6256369, 3763681, 3536981, 1952462, 652028, 1846989, 3225366, 5873160, 6175678, 6385838, 2326904, 2033032, 6939974, 3956968, 5448371, 4918207, 360033, 2396794, 2543021, 1918523],
    ], 
    [ 
    [6075728, 1818454, 6042729, 4977629, 3684749, 943539, 6421787, 3971617, 7337455, 1010214, 7035951, 3220097, 5029908, 6621089, 3638949, 4423674, 1130508, 5041893, 4392778, 4330074, 580401, 1163270, 6663918, 6972085, 5232440, 6900533, 31123, 4068765, 5688144, 5997521, 1483617, 2377969, 5995633, 2280325, 5479678, 6078027, 2030913, 5357820, 3521465, 6284949, 1346989, 5830881, 6990496, 3996364, 1788810, 4954649, 2522403, 4430878, 5821866, 4943674, 6355228, 4404481, 2112957, 5133503, 3881041, 4696391, 2092320, 1181918, 1531211, 6421174, 3829877, 1204604, 4224917, 6459604, 735667, 4292311, 3756287, 6916592, 4807909, 5196245, 5933359, 3214814, 6877616, 3407737, 975190, 2846615, 7217895, 1428659, 3700177, 7008530, 6291547, 5231851, 1441766, 7085775, 1436822, 1771421, 6327129, 3277038, 2250051, 4472358, 1776758, 4074323, 7285822, 5693214, 3105071, 5091486, 258594, 6090166, 6062102, 2089802, 2936762, 4568076, 5071541, 2123772, 6240752, 1494656, 1605954, 4046461, 739601, 4793991, 1978282, 2307048, 2168482, 5735063, 6690232, 5410793, 1295695, 703738, 7256636, 1751971, 1609823, 6251903, 3425351, 2664737, 3123788, 1469926, 3987336, 659796, 5999914, 4406694, 886063, 6039196, 5662124, 2695683, 1045400, 7036573, 1043136, 5452007, 5723214, 4261053, 7235375, 2499077, 5176630, 1039900, 494174, 4535226, 6325015, 474428, 4220894, 5232859, 1774290, 5748209, 3857699, 2601994, 883659, 7178719, 5371928, 6100975, 2748201, 2884536, 7258267, 3396603, 6847809, 5119908, 1493193, 4605134, 2988366, 671071, 77942, 537913, 4749691, 4200790, 160883, 6382597, 6675321, 5284758, 4004639, 2104157, 1678455, 4865722, 4526169, 3736324, 3253748, 5676926, 3126620, 3641794, 3203906, 5596, 5742253, 7084413, 6719515, 1161843, 4632119, 4009878, 6338375, 1772532, 2462345, 7324351, 3035918, 203809, 7014856, 4152111, 6222506, 6037202, 3862045, 4720725, 6822525, 4771582, 4164439, 3233953, 260385, 3012505, 6534676, 6688961, 6003173, 5910687, 5765550, 6909974, 1180075, 6099011, 1156738, 5808487, 2464131, 4160820, 5474584, 7004953, 3717450, 216978, 4195298, 982108, 5709310, 826803, 3352566, 6717956, 934377, 6651599, 4107727, 1736509, 1908149, 6321964, 3204448, 5121368, 2062148, 2181272, 3802476, 4324273, 2995654, 1206294, 2910165, 4776312, 7132973, 705853, 2658901, 6149097, 6949143, 2617014],
    [2793890, 5699138, 2699656, 7290318, 6787646, 44774, 6701817, 3577990, 3690201, 822834, 4637391, 2622640, 4435149, 4785016, 6280132, 709712, 546783, 2670299, 3278855, 7233536, 6478546, 7230852, 65471, 209301, 3948745, 2226295, 39730, 1002642, 756460, 5671299, 991859, 3674407, 6908098, 6023250, 3252367, 2043794, 1573352, 6053977, 5390001, 538641, 1875672, 3098777, 5463815, 2738774, 5329904, 1562165, 2668988, 307814, 2946696, 5638643, 1580732, 737597, 6390671, 1794253, 5369448, 1117826, 3617510, 3936, 6276136, 3870893, 6489812, 5076043, 3996409, 634335, 3247162, 240618, 2458017, 150062, 1473745, 2596079, 254834, 333754, 355758, 3558031, 4010293, 5949737, 1488496, 5904517, 1212194, 5735455, 6585041, 2163668, 3903022, 2703479, 6686296, 2940076, 3314013, 7250860, 6593896, 5704288, 4354665, 5630292, 1698662, 293495, 745377, 410168, 4646239, 6141693, 383744, 359102, 6377548, 5229359, 6599172, 3184232, 4078557, 3251737, 283430, 5944609, 5493689, 2287445, 6306870, 7336532, 3285280, 4732941, 2621866, 7304822, 6369584, 3215330, 3810363, 5920009, 6785588, 6710638, 1876585, 1113638, 7281618, 2507782, 7153397, 4813803, 5418135, 287046, 5672196, 3597770, 4609915, 2412260, 4123861, 1813344, 3360936, 1030273, 5304700, 2981187, 6303795, 4875051, 4315398, 3664700, 2513729, 2454766, 279048, 6678443, 5948579, 6462394, 4602603, 5745556, 4690224, 5206008, 7268898, 219538, 5351899, 7324591, 5001010, 7336198, 2672270, 5955206, 7034378, 771171, 4058753, 6808193, 2312791, 1017471, 1452765, 3963140, 5297475, 6876333, 4975349, 1455661, 2124775, 878913, 2556628, 3796603, 2683814, 6467856, 542270, 6502222, 2486692, 4811314, 4946878, 3972229, 6441399, 1672461, 5413843, 3251873, 4439234, 7238537, 5182954, 7181102, 396066, 3906552, 1833535, 3667761, 1323794, 1297112, 1185675, 6002318, 964528, 4630148, 3386973, 246393, 7333041, 4871112, 7108182, 4977147, 7178123, 6060668, 6567265, 394662, 6917721, 3921339, 4760060, 4700630, 7188686, 5519299, 1668768, 6462350, 4758841, 3159172, 2630362, 354199, 4802599, 3028283, 4557740, 4997389, 978462, 6355611, 5592797, 1891117, 1815793, 4441948, 715862, 4277386, 4185058, 6101120, 3244556, 2240212, 6333093, 5025719, 7274490, 6786241, 3198680, 2663666, 1460709, 3501240, 1961556, 6759229, 3650273, 5612270, 5760728, 4848494],
    [533548, 6459505, 1163348, 3064103, 237389, 5874921, 3142641, 24507, 2199107, 6228673, 5387240, 6064816, 6505920, 4219407, 2047387, 2022304, 412146, 7134839, 3644625, 2418363, 4654384, 4968241, 5663183, 4756777, 6440935, 3880246, 1086861, 1700801, 1228564, 2289396, 5180986, 7281901, 5253726, 4080820, 1701810, 7042669, 542984, 2444858, 6470041, 355113, 1684521, 6123505, 1902459, 2078116, 6397567, 3495505, 3653920, 741236, 6333674, 7086005, 3146344, 474733, 3993813, 3833435, 145506, 3950494, 558298, 3103100, 1194612, 5685415, 4264175, 1141523, 2906072, 6863145, 3226472, 7166818, 1250477, 6663968, 3384184, 3210465, 6217832, 6457073, 3443628, 609002, 1668717, 2017579, 792212, 5004931, 5670481, 4342609, 6109185, 4086405, 1779957, 5740672, 1054568, 5793170, 1119480, 4803490, 612589, 3616598, 3583884, 4988794, 1497430, 5802144, 1065173, 5652239, 5029965, 6689878, 2680421, 4379625, 1228996, 2075236, 5512590, 6941445, 6220896, 4221084, 4090843, 256972, 3012468, 402530, 6815099, 4689282, 435644, 883418, 4339720, 2185167, 1661288, 727156, 5554769, 1052516, 2965474, 4864042, 1973577, 3170199, 6441121, 4677892, 2734041, 5375411, 7025196, 3263758, 2009327, 5057901, 835957, 2888970, 3279042, 4736078, 2824181, 4125144, 3797193, 5469247, 4179614, 4076750, 145872, 3512559, 4011714, 1941017, 6938779, 6925214, 5146368, 4550012, 5978287, 6899084, 3195660, 6405035, 7060254, 5451908, 5416912, 762792, 3135605, 3106605, 2266500, 2822636, 4451259, 4734427, 2923747, 4351801, 2189818, 5015746, 6360200, 4478508, 2237394, 1684890, 842539, 5129761, 6074770, 7301663, 642849, 4146396, 3332107, 6562438, 4657917, 6073866, 1244645, 6222506, 5890345, 3829451, 5401296, 6579926, 5393830, 4284583, 3720223, 6625446, 6225812, 2558373, 6356890, 2446927, 6961141, 6999971, 5996903, 5844723, 7103262, 1694774, 1851440, 3246203, 4959178, 2431829, 2989004, 1800771, 5214516, 397245, 5878856, 603531, 6314199, 6805954, 1553072, 2886970, 1382080, 6117275, 4120674, 1465633, 108749, 1494308, 6119210, 6301119, 3132525, 5468902, 153901, 3667097, 6924890, 4480278, 2672452, 4409828, 5954483, 1968278, 2801248, 664413, 5909196, 4218989, 6369680, 6997813, 2072707, 171215, 7003732, 1343818, 1368610, 2120684, 531936, 5839952, 3416670, 2007174, 6530091, 3475813, 3292645, 1645170, 557108, 2219208],
    [1217008, 3064567, 1813725, 4045847, 7176338, 7304487, 4258140, 6893882, 4294389, 7199534, 5957286, 6892133, 3941097, 3229983, 3387460, 2424672, 1013882, 456104, 6422597, 3799486, 7162503, 4601190, 3206524, 3104135, 4405236, 3491257, 5450707, 7250180, 3458610, 621307, 6450715, 5695250, 4141239, 1051632, 2166212, 2214032, 556798, 383444, 2209480, 2218541, 4879121, 3530970, 5143614, 1353032, 6037723, 5395366, 5324357, 3121735, 4799995, 6993048, 3933795, 329674, 2572568, 2815029, 1647969, 4406801, 3985460, 5144163, 5073134, 1906788, 4959217, 4852414, 2270365, 1028212, 1126980, 6096232, 5528116, 6505824, 137818, 2385569, 3439989, 4585893, 3767616, 2507212, 6781352, 5261714, 4075677, 5266831, 403241, 4115161, 2684798, 4337153, 983887, 90801, 898086, 1507500, 7246876, 6688952, 1024239, 41127, 1557953, 2039229, 2366478, 3444071, 6058377, 6628256, 6565812, 6200303, 2426536, 2637685, 2493930, 5095368, 7267983, 921346, 6872799, 957002, 1610057, 3506580, 7277305, 4358756, 2530463, 2688997, 6651144, 2408188, 6999383, 6290505, 5476248, 1655296, 5963385, 2345940, 1928785, 2038795, 4634739, 535052, 564368, 936351, 1383966, 3697936, 3566189, 4915267, 6110681, 1725343, 4797724, 4633481, 4418072, 3888498, 6630443, 2022810, 4552959, 4466848, 1668052, 5072103, 2713529, 5199309, 4943992, 1398766, 1421542, 6600150, 5770381, 3632142, 5727531, 1720533, 5586103, 5804816, 5799895, 7168020, 3388788, 4412882, 6377629, 6773696, 1262614, 3368413, 5719663, 6669933, 2057115, 6694907, 2670920, 715696, 6700954, 1280781, 6265785, 2285837, 709069, 4951754, 5344092, 562990, 6451755, 4013272, 1913345, 5616467, 4408472, 3069730, 5454484, 6530191, 825468, 5683457, 757546, 2602459, 1816285, 6290260, 2042268, 667762, 6266336, 3731956, 2975366, 7234497, 638769, 5469379, 4399960, 6486760, 1572804, 4079438, 4027567, 992556, 7137462, 2911159, 5429977, 1256539, 3149628, 245986, 6569507, 1629845, 4765451, 6993669, 1041536, 4113483, 3916402, 265466, 5908636, 17644, 2366015, 2083525, 3421339, 435079, 1269783, 6811701, 2447861, 1830343, 5866847, 5395787, 2175887, 1800112, 6586274, 669430, 1046524, 4615185, 188343, 3924214, 7082001, 1694942, 4389450, 2255355, 965692, 6850435, 6217697, 911986, 3619235, 902185, 639492, 1486303, 4245908, 2750100, 1588173, 4419922, 3579190, 3714262],
    ]
];

const HTR: [u64;HASH_STATE_WIDTH] = [677417, 611466, 4336421, 2300803, 3046594, 4399100, 4364254, 516947, 6328490, 30133, 2823142, 6715498, 5308957, 7165742, 6850294, 5964650, 3951917, 5579908, 4975093, 371624, 3851416, 3799034, 905551, 3385886, 7081023, 5589663, 7276359, 6438915, 4764965, 3329391, 5281941, 5532262, 3182565, 2851502, 2574579];


// DILITHIUM VERIFICATION
// ================================================================================================
pub(crate) fn prove(
    z: [[BaseElement; N]; K],
    w: [[BaseElement; N]; K],
    qw: [[BaseElement; N]; K],
    ctilde: [BaseElement; HASH_DIGEST_WIDTH],
    m: [BaseElement; 12],
    com_r: [BaseElement; 12]
) -> StarkProof {
    // 48,4,20
    // 32,8,20
    // 24,16,20
    // 19,32,21
    // 16,64,20
    // 14,128,20
    let options = ProofOptions::new(
        48, // number of queries
        4,  // blowup factor
        20,  // grinding factor
        HashFunction::Blake3_256,
        FieldExtension::Sextic,
        8,   // FRI folding factor
        128, // FRI max remainder length
    );

    debug!(
        "Generating proof for correctness of Dilithium
        ---------------------"
    );

    // create a prover
    let prover = ThinDilProver::new(options.clone(), z, w, qw, ctilde, m, com_r);

    // generate execution trace
    let now = Instant::now();
    let trace = prover.build_trace();

    let trace_width = trace.width();
    let trace_length = trace.length();
    debug!(
        "Generated execution trace of {} registers and 2^{} steps in {} ms",
        trace_width,
        log2(trace_length),
        now.elapsed().as_millis()
    );

    // generate the proof
    prover.prove(trace).unwrap()
}

pub(crate) fn verify(proof: StarkProof, m: [BaseElement; HASH_DIGEST_WIDTH]) -> Result<(), VerifierError> {
    let pub_inputs = PublicInputs{m};
    winterfell::verify::<ThinDilAir>(proof, pub_inputs)
}

pub(crate) fn verify_with_wrong_inputs(proof: StarkProof, m: [BaseElement; HASH_DIGEST_WIDTH]) -> Result<(), VerifierError> {
    let pub_inputs = PublicInputs{m};
    winterfell::verify::<ThinDilAir>(proof, pub_inputs)
}

